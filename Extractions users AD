

# Récupérer tous les utilisateurs de l'Active Directory
(sur aegidecontrol1 ou control2)

Script 1:
# Importer le module Active Directory (nécessaire si vous travaillez avec AD)
Import-Module ActiveDirectory

# Récupérer les informations des utilisateurs de l'AD
Get-ADUser -Filter * -Property SamAccountName, Name, whenCreated, whenChanged, lastLogonDate, Enabled, AccountExpirationDate | 
Select-Object @{Name="Identifiant"; Expression = {$_.SamAccountName}},
              @{Name="Nom"; Expression = {$_.Name}},
              @{Name="Date de Création"; Expression = {$_.whenCreated}},
              @{Name="Date de Dernière Modification"; Expression = {$_.whenChanged}},
              @{Name="Dernière Connexion"; Expression = { if ($_.lastLogonDate) {$_.lastLogonDate } else { "Jamais connecté" }}},
              @{Name="Statut du Compte"; Expression = { if ($_.Enabled) { "Actif" } else { "Désactivé" }}},
              @{Name="Date de Désactivation"; Expression = { if ($_.AccountExpirationDate) { $_.AccountExpirationDate } else { "N/A" }}} |
Export-Csv -Path "C:\temp\utilisateurs_AD_test2.csv" -NoTypeInformation -Encoding UTF8

Write-Host "Extraction des informations AD terminée."

Script 2:

# Créer une liste pour stocker les résultats
$UserList = @()
 
# Parcourir chaque utilisateur et collecter les informations
foreach ($user in $users) {
    $UserInfo = New-Object PSObject -Property @{
        "Identifiant"            = $user.SamAccountName
        "Nom d'utilisateur"      = $user.Name
        "Date de création"       = $user.whenCreated
        "Dernière mise à jour"   = $user.whenChanged
        "Statut"                 = if ($user.Enabled) { "Actif" } else { "Non actif" }
        "Date de désactivation"  = if ($user.AccountExpirationDate) { $user.AccountExpirationDate } else { "N/A" }
        "Dernière connexion"     = if ($user.LastLogonDate) { $user.LastLogonDate } else { "Jamais connecté" }
    }
    # Ajouter les informations à la liste
    $UserList += $UserInfo
}
 
# Exporter les résultats dans un fichier CSV
$UserList | Export-Csv -Path "C:\temp\ListeUtilisateursAD.csv" -NoTypeInformation

### Script 3
Recuperer les user actifs

# Importer le module Active Directory (nécessaire si vous travaillez avec AD)
Import-Module ActiveDirectory

Get-ADUser -Filter {Enabled -eq $true} -Property SamAccountName, Name, whenCreated, whenChanged, lastLogonDate, Enabled, AccountExpirationDate | 
Select-Object @{Name="Identifiant"; Expression = {$_.SamAccountName}},
              @{Name="Nom"; Expression = {$_.Name}},
              @{Name="Date de Création"; Expression = {$_.whenCreated}},
              @{Name="Date de Dernière Modification"; Expression = {$_.whenChanged}},
              @{Name="Dernière Connexion"; Expression = { if ($_.lastLogonDate) {$_.lastLogonDate } else { "Jamais connecté" }}},
              @{Name="Statut du Compte"; Expression = { if ($_.Enabled) { "Actif" } else { "Désactivé" }}},
              @{Name="Date de Désactivation"; Expression = { if ($_.AccountExpirationDate) { $_.AccountExpirationDate } else { "N/A" }}} |
Export-Csv -Path "C:\temp\utilisateurs_AD_actifs.csv" -NoTypeInformation -Encoding UTF8

Write-Host "Extraction des utilisateurs actifs terminée."

Here is some examples:

This displays all members from the DL recursively:

c:\> Gather-DLMembers -GroupIdentity DL-Name

This will export the member list information (Name,Email) to a CSV file.

c:\> Gather-DLMembers -GroupIdentity DL-Name | Select DisplayName,PrimarySMTPAddress | Export-CSV -Path .\DL-Name-Members.csv

This will store the member list in a variable:

c:\> $Members = Gather-DLMembers -GroupIdentity DL-Name

****

Get-ADUser -Filter * -Property SamAccountName, Name, whenCreated, whenChanged, lastLogonDate, Enabled | Select-Object @{Name="Identifiant"; Expression = {$_.SamAccountName}},@{Name="Nom"; Expression = {$_.Name}},@{Name="Date de Création"; Expression = {$_.whenCreated}},@{Name="Date de Dernière Modification"; Expression = {$_.whenChanged}},@{Name="Dernière Connexion"; Expression = {$_.lastLogonDate}}, @{Name="Statut du Compte"; Expression = { if ($_.Enabled) { "Actif" } else { "Désactivé" }}} |Export-Csv -Path "C:\temp\utilisateurs_ADperso.csv" -NoTypeInformation -Encoding UTF8
           


Get-ADUser -Filter "SamAccountName -eq 'Administrateur'" -Server SRV-ADDS-01.it-connect.local
